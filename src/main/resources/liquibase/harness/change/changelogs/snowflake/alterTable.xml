<?xml version="1.0" encoding="UTF-8"?>
<!-- Schema Isolated Test - No init.xml or cleanup needed -->
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:snowflake="http://www.liquibase.org/xml/ns/snowflake"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd
        http://www.liquibase.org/xml/ns/snowflake
        http://www.liquibase.org/xml/ns/snowflake/liquibase-snowflake-latest.xsd">

    <!-- Create test tables using Liquibase changeTypes for proper schema isolation -->
    <changeSet id="create-test-table-cluster" author="test-harness">
        <createTable tableName="TEST_TABLE_CLUSTER">
            <column name="id" type="INT"/>
            <column name="name" type="VARCHAR(50)"/>
            <column name="created_date" type="DATE"/>
            <column name="region" type="VARCHAR(20)"/>
        </createTable>
    </changeSet>

    <changeSet id="create-test-table-properties" author="test-harness">
        <createTable tableName="TEST_TABLE_PROPERTIES">
            <column name="id" type="INT"/>
            <column name="data" type="VARCHAR(100)"/>
            <column name="timestamp" type="TIMESTAMP"/>
        </createTable>
    </changeSet>

    <changeSet id="create-test-table-combined" author="test-harness">
        <createTable tableName="TEST_TABLE_COMBINED">
            <column name="id" type="INT"/>
            <column name="name" type="VARCHAR(50)"/>
            <column name="value" type="DECIMAL(10,2)"/>
        </createTable>
    </changeSet>

    <changeSet id="create-test-table-drop-cluster" author="test-harness">
        <createTable tableName="TEST_TABLE_DROP_CLUSTER" snowflake:clusterBy="id,name">
            <column name="id" type="INT"/>
            <column name="name" type="VARCHAR(50)"/>
            <column name="value" type="DECIMAL(10,2)"/>
        </createTable>
    </changeSet>

    <!-- Test 1: Basic clustering -->
    <changeSet id="test-alterTable-clustering" author="test-harness">
        <snowflake:alterTable tableName="TEST_TABLE_CLUSTER"
                             clusterBy="region,created_date"/>
    </changeSet>

    <!-- Test 2: Drop clustering key -->
    <changeSet id="test-alterTable-drop-clustering" author="test-harness">
        <snowflake:alterTable tableName="TEST_TABLE_DROP_CLUSTER"
                             dropClusteringKey="true"/>
    </changeSet>

    <!-- Test 3: Property settings -->
    <changeSet id="test-alterTable-properties" author="test-harness">
        <snowflake:alterTable tableName="TEST_TABLE_PROPERTIES"
                             setDataRetentionTimeInDays="30"
                             setChangeTracking="true"
                             setEnableSchemaEvolution="false"/>
    </changeSet>

    <!-- Test 4: Combined operations (clustering + properties in separate changesets) -->
    <changeSet id="test-alterTable-cluster-first" author="test-harness">
        <snowflake:alterTable tableName="TEST_TABLE_COMBINED"
                             clusterBy="id,value"/>
    </changeSet>
    
    <changeSet id="test-alterTable-properties-second" author="test-harness">
        <snowflake:alterTable tableName="TEST_TABLE_COMBINED"
                             setDataRetentionTimeInDays="7"
                             setChangeTracking="false"/>
    </changeSet>

</databaseChangeLog>